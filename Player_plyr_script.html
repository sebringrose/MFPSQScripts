<!-- 1. Load FlowPlayer scripts -->
<!-- 2. Retrieve "id" from page URL params -->
<!-- 3. Call flowplayer API middleware with "id" as "name" -->
<!-- 4. Check response valid, if so trigger FlowPlayer scripts with film data -->

<link rel="stylesheet" href="//cdn.flowplayer.com/releases/native/stable/style/flowplayer.css">
<script src="//cdn.flowplayer.com/releases/native/stable/flowplayer.min.js"></script>
<!-- Optional plugins -->
<script src="//cdn.flowplayer.com/releases/native/stable/plugins/hls.min.js"></script>
<script>
    window.flowPlayerVideoId = new URLSearchParams(window.location.search).get('id')
    document.querySelector("#film-title").textContent = window.flowPlayerVideoId
    fetch(`https://flowplayer-middleware.azurewebsites.net/api/getVideo?code=71QIkhIZbREwZek4nRNjIjSsWJcu7GAbKncFKnz30JGviBDCxokuog%3D%3D&name=${encodeURIComponent(window.flowPlayerVideoId)}`)
        .then(response => response.json())
        .then(films => {
            console.log(films)
            if (!films[0]) return alert("No film found! Please try selecting a film again.")
            window.flowPlayerData = films[0]
            document.querySelector("#film-desc").textContent = films[0].description
            flowplayer('#player_container', {
                src: films[0].mediafiles.m3u8_url,
                poster: films[0].images.normal_image_url,
                preload: "auto",
                token: 'eyJraWQiOiJBblJBR3VYN1lNbDkiLCJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJjIjoie1wiYWNsXCI6NCxcImlkXCI6XCJBblJBR3VYN1lNbDlcIixcImRvbWFpblwiOltcInd3dy5taW51dGVzaG9ydHMuY28udWtcIixcImp1bGlhbi12aWZvci5zcXVhcmVzcGFjZS5jb21cIl19IiwiaXNzIjoiRmxvd3BsYXllciJ9.ZQ_BBs6sCSvis4skaHIeZIyGKUSGRtaGFtix7RXZh53G1QzHN8ooMdE_N-8OcuYi_ePDeL1cAAzpPTeACQ2wAQ'
            })
        })
</script>