<style>
    #siteWrapper {
        background: black;
    }
    @media only screen and (min-width: 1200px) {
        #siteWrapper {
            background-image: 
                linear-gradient(#21212150, #21212150),
                url('https://raw.githubusercontent.com/sebringrose/MinuteSquarespaceScripts/main/assets/Asset_bgScene.jpeg');
            background-repeat: no-repeat;
            background-position: top;
            background-size: contain;
        }
    }
    section {
        width: 100%;
        max-width: 100%;
        display: flex;
        flex-wrap: wrap;
    }
    section h1, section h2, section h3, section h4, section p {
        line-height: normal !important;
        font-family: Lato !important;
        font-weight: 600 !important;
        color: white !important;
    }
    section p {
        font-size: 15px !important;
    }
    section hr {
        width: calc(100% - 2rem) !important;
        border: none !important;
        border-bottom: 2px solid black !important;
    }
    section h2 {
        margin: 1em .5rem .5em !important;
    }
    .title-div {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }
    #film-desc {
        margin: .5rem;
    }
    .button-div {
        flex: 1;
        max-width: 300px;
        min-width: 150px;
        margin: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .empire-btn img {
        width: 32px;
        margin-right: 5px;
    }
    .carousel-arrow {
        cursor: pointer;
        filter: brightness(0) saturate(100%) invert(90%) sepia(10%) saturate(4680%) hue-rotate(316deg) brightness(105%) contrast(110%);
    }
</style>

<div id="loading" style="display: none; width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.4); z-index: 999;">
    <img alt="loading" src="https://raw.githubusercontent.com/sebringrose/MinuteSquarespaceScripts/main/assets/Asset_loadingAnimation.gif" style="max-width: 80vw; margin: auto;">
</div>

<section id="selected-section">
    <h1 id="selected-title" style="margin: auto;">You Selected: </h1>
</section>

<section id="carousel-section" style="flex-wrap: wrap;">
    <div id="carousel-left-arrow">
        <img onclick="populatePage()" class="carousel-arrow" src="https://raw.githubusercontent.com/sebringrose/MinuteSquarespaceScripts/main/assets/Asset_chevron.png" alt="left-arrow" style="transform: rotate(90deg);">
    </div>
    <div id="carousel-items" style="flex: 1;">

    </div>
    <div id="carousel-right-arrow">
        <img onclick="populatePage()" class="carousel-arrow" src="https://raw.githubusercontent.com/sebringrose/MinuteSquarespaceScripts/main/assets/Asset_chevron.png" alt="left-arrow" style="transform: rotate(270deg);">
    </div>
    <button onclick="selectFilm('A World Between Women Teaser Trailer')">
        Select Film
    </button>
</section>

<section id="button-section">
    <div class="button-div">
        <button class="empire-btn" onclick="window.location.href = '/'">
            <img alt="results" src="https://raw.githubusercontent.com/sebringrose/MinuteSquarespaceScripts/main/assets/Asset_iconHome.svg">
            Home
        </button>
    </div>
    <div class="button-div">
        <button class="empire-btn" onclick="populatePage()">
            Shuffle again
            <img alt="results" src="https://raw.githubusercontent.com/sebringrose/MinuteSquarespaceScripts/main/assets/Asset_iconShuffle.svg">
        </button>
    </div>
</section>

<!-- POPULATE PAGE CONTENT FUNCTION -->
<script>
    window.populatePage = async () => {
        // get tag from URL and write to selected-title
        const tag = decodeURIComponent(new URLSearchParams(window.location.search).get('t'))
        if (!!tag) return alert("No film tag provided. Please go to home page and select an option.")
        document.querySelector("#selected-title").textContent = `You Selected: ${tag}`

        // display loading animation
        document.querySelector("#loading").style.display = "flex"

        // fetches set of film trailers that match tag
        let films = await fetch(`https://flowplayer-middleware.azurewebsites.net/api/getVideo?code=71QIkhIZbREwZek4nRNjIjSsWJcu7GAbKncFKnz30JGviBDCxokuog%3D%3D&tags=${encodeURIComponent(tag)},film_trailer&pageSize=6`)
            .then(response => response.json())

        // alert user if no matching films found
        if (!films[0]) alert("No films matching supplied tag found! Please go to home page and try another option.")
        
        // remove any repeat results (only if we have enough results)
        let prevFilms = localStorage.getItem('results') ? JSON.parse(localStorage.getItem('results')).films : null
        if (prevFilms && films.length > prevFilms.length) films.filter(film => prevFilms.some(prevFilm => film.name !== prevFilm.name))

        // store tag and film results in localStorage.
        // this is used to make sure not to display repeat options on shuffle
        // and to correctly route back to same results from player page.
        localStorage.setItem('results', JSON.stringify({ tag, films }))

        // hide loading animation
        document.querySelector("#loading").style.display = "none"

        console.log(films)
    }
    
    // initial page load
    populatePage()
</script>

<!-- SELECT FILM FUNCTION -->
<script>
    window.selectFilm = (name) => {
        // trailer-specific part of name
        const trailerString = " Trailer"
        if (!name.includes(trailerString)) return alert("Incorrect trailer name. Please contact an admin to resolve this issue.")
        
        // remove trailer-specific name part
        const filmName = name.slice(0, name.indexOf(trailerString))

        window.location.href = `/player?id=${encodeURIComponent(filmName)}`
    }
</script>